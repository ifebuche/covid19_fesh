import numpy as np
import pytest

import pandas as pd
from pandas.core.internals import BlockManager
<<<<<<< HEAD
from pandas.core.internals.blocks import ExtensionBlock


class CustomBlock(ExtensionBlock):

    _holder = np.ndarray
    _can_hold_na = False
=======
from pandas.core.internals.blocks import Block, NonConsolidatableMixIn


class CustomBlock(NonConsolidatableMixIn, Block):

    _holder = np.ndarray
>>>>>>> 27dd9875f98c51b82553091a9dbcf027191524ef

    def concat_same_type(self, to_concat, placement=None):
        """
        Always concatenate disregarding self.ndim as the values are
        always 1D in this custom Block
        """
        values = np.concatenate([blk.values for blk in to_concat])
<<<<<<< HEAD
        placement = self.mgr_locs if self.ndim == 2 else slice(len(values))
        return self.make_block_same_class(values, placement=placement)
=======
        return self.make_block_same_class(
            values, placement=placement or slice(0, len(values), 1)
        )
>>>>>>> 27dd9875f98c51b82553091a9dbcf027191524ef


@pytest.fixture
def df():
    df1 = pd.DataFrame({"a": [1, 2, 3]})
<<<<<<< HEAD
    blocks = df1._mgr.blocks
=======
    blocks = df1._data.blocks
>>>>>>> 27dd9875f98c51b82553091a9dbcf027191524ef
    values = np.arange(3, dtype="int64")
    custom_block = CustomBlock(values, placement=slice(1, 2))
    blocks = blocks + (custom_block,)
    block_manager = BlockManager(blocks, [pd.Index(["a", "b"]), df1.index])
    return pd.DataFrame(block_manager)


<<<<<<< HEAD
=======
def test_concat_series():
    # GH17728
    values = np.arange(3, dtype="int64")
    block = CustomBlock(values, placement=slice(0, 3))
    s = pd.Series(block, pd.RangeIndex(3), fastpath=True)

    res = pd.concat([s, s])
    assert isinstance(res._data.blocks[0], CustomBlock)


def test_concat_dataframe(df):
    # GH17728
    res = pd.concat([df, df])
    assert isinstance(res._data.blocks[1], CustomBlock)


>>>>>>> 27dd9875f98c51b82553091a9dbcf027191524ef
def test_concat_axis1(df):
    # GH17954
    df2 = pd.DataFrame({"c": [0.1, 0.2, 0.3]})
    res = pd.concat([df, df2], axis=1)
<<<<<<< HEAD
    assert isinstance(res._mgr.blocks[1], CustomBlock)
=======
    assert isinstance(res._data.blocks[1], CustomBlock)
>>>>>>> 27dd9875f98c51b82553091a9dbcf027191524ef
